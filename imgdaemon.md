# Project ImgDaemon

![PHP](https://img.shields.io/badge/PHP-777BB4?logo=php&logoColor=white&labelColor=777BB4)
![Slim](https://img.shields.io/badge/Slim-4584B6?logo=slim&logoColor=white&labelColor=4584B6)
![pThreaded](https://img.shields.io/badge/pThreaded-CCCCCC?logo=C&logoColor=white&labelColor=CCCCCC)
![cURL](https://img.shields.io/badge/cURL-00758F?logo=curl&logoColor=white&labelColor=00758F)
![Tailwind CSS](https://img.shields.io/badge/Tailwind_CSS-38B2AC?logo=tailwind-css&logoColor=white&labelColor=38B2AC)
![ImageMagick](https://img.shields.io/badge/ImageMagick-44A3E5?logo=image%20magick&logoColor=white&labelColor=44A3E5)
![BackBlaze](https://img.shields.io/badge/BackBlaze-0052CC?logo=backblaze&logoColor=white&labelColor=0052CC)
![S3](https://img.shields.io/badge/S3-569A31?logo=amazon%20s3&logoColor=white&labelColor=569A31)

### What
A distributed infinitely scalable image processing and backup engine to process millions of images


### Why
The company had a subsidiary focused on building AI image generation of cars. You could provide a VIN and images will be generated based on those specifications. They needed lots of data to train AI models. Millions of images to be precise.  

### How
I was the sole contributor to building a scalable image processing system. Leveraging PHP as the core programming language, coupled with the powerful capabilities of ImageMagick, our system was engineered to seamlessly handle the processing of millions of images daily.

One of the key architectural decisions was the implementation of a distributed system, allowing for the addition of servers to scale the processing capabilities infinitely. This approach not only ensured optimal performance but also provided flexibility to accommodate varying workloads.

For storage, we integrated seamlessly with Amazon Web Services (AWS) S3, harnessing its reliability and scalability to store the vast amount of image data generated by the system. Additionally, to safeguard against data loss, we incorporated Backblaze as our backup service, ensuring the integrity of our image repository.

Central to our image processing pipeline was the utilization of ImageMagick, a versatile multimedia framework, for tasks such as video transcoding and manipulation. Its robust features and compatibility with various multimedia formats made it an ideal choice for our needs. We wanted to watermark and resize images before storage.

### Challenges 
- PHP & infinite runtime
We wanted PHP because all our engineers were familiar with it. And we wanted this system to run continuously. PHP doesn't play well with processing running too long. I ran into several issues including memory leaks, unexpected kill and more.
The solution was to implement an automated graceful shutdown and restart. 

- Database locks and performance
We were stuck with an older version of MySQL and ran into performance issues including long locks etc. Hence, we implemented a flat file-based read system to speed up this process and eventually update the database at lower load times.
